#!/usr/bin/python3 -B

import os
import shutil
import sys
from config import *
from component import *
from component_command import component_command
from graph import graphs_get_list
from graph_command import graph_command
from schema_command import schema_command

print('Database directory:', os.path.expanduser(GRDB_DIR))

gno = (-1)
cno = (-1)

# Determine initial current graph and component number
glist = graphs_get_list()
gnolist = list(map(int, glist))
if gnolist:
	gno = min(gnolist)

if gno >= 0:
	clist = components_get_list(gno)
	cnolist = list(map(int, clist))
	if cnolist:
		cno = min(cnolist or (-1))

# Main command line loop
while True:
	# Determine appropriate prompt
	if gno < 0 or cno < 0:
		line = input(PROMPT)
	else:
		line = input(str(gno) + '.' + str(cno) + '> ')

	argv = line.split()

	if len(argv) == 0:
		continue

	if argv[0] == 'quit':
		sys.exit(0)

	if argv[0] == 'clear':
		rdir = os.path.expanduser(GRDB_DIR)
		shutil.rmtree(rdir, ignore_errors=True)
		os.mkdir(rdir)
		gno = (-1)
		cno = (-1)
		continue;

	if argv[0] == 'graph' or argv[0] == 'g':
		gno, cno = graph_command(argv, gno, cno)
		continue

	if argv[0] == 'component' or argv[0] == 'c':
		gno, cno = component_command(argv, gno, cno)
		continue

	if argv[0] == 'schema' or argv[0] == 's':
		schema_command(argv, gno, cno)
		continue
